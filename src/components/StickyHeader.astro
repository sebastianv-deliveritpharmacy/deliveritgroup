---
const {
  logoSrc = "/images/logo-deliverit.png",
} = Astro.props;

const links = [
  { label: "Infusion", href: "#infusion" },
  { label: "Retail", href: "#retail" },
  { label: "DeliverIt Health", href: "#DeliverItHealth" },
  { label: "GCC Training", href: "#gccTraining" }, // âœ… NEW
  { label: "DeliverIt Research & Development", href: "#DeliverItRAD" },
];
---

<header class="site-header" aria-label="Top navigation">
  <div class="shell">
    <a class="brand" href="#home" aria-label="DeliverIt Group">
      <img src={logoSrc} alt="DeliverIt logo" width="120" height="36" />
    </a>

    <!-- Hamburger -->
    <button class="menu"
      aria-label="Open menu"
      aria-expanded="false"
      aria-controls="primary-nav">
      <span></span><span></span><span></span>
    </button>

    <nav id="primary-nav" class="nav" aria-label="Primary" role="navigation">
      {links.map(l => (
        <a class="nav-link" href={l.href}>{l.label}</a>
      ))}
      <!-- Optional CTA that jumps to GCC section -->
      <a class="nav-cta" href="#gccTraining">Partner Training</a>
    </nav>
  </div>
</header>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const header = document.querySelector('.site-header');
    if (!header) return;

    const btn = header.querySelector('.menu');
    const nav = header.querySelector('.nav');
    const navLinks = [...header.querySelectorAll('.nav-link')];
    const cta = header.querySelector('.nav-cta');

    // Sticky shrink on scroll
    const onScroll = () => {
      header.classList.toggle('scrolled', window.scrollY > 8);
    };
    onScroll();
    window.addEventListener('scroll', onScroll, { passive: true });

    // Open/close menu
    const setOpen = (open) => {
      header.classList.toggle('open', open);
      btn.setAttribute('aria-expanded', String(open));
      if (open) {
        // Focus trap: focus first focusable in nav
        const focusables = nav.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])');
        if (focusables.length) focusables[0].focus();
      } else {
        btn.focus();
      }
    };
    btn.addEventListener('click', () => setOpen(!header.classList.contains('open')));

    // Close on ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && header.classList.contains('open')) setOpen(false);
      if (e.key === 'Tab' && header.classList.contains('open')) {
        // Keep focus inside nav
        const focusables = [...nav.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])')];
        if (!focusables.length) return;
        const first = focusables[0];
        const last = focusables[focusables.length - 1];
        if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
      }
    });

    // Close menu when clicking a link (mobile)
    [...header.querySelectorAll('.nav a')].forEach(a =>
      a.addEventListener('click', () => setOpen(false))
    );

    // Scroll spy + aria-current
    const allLinks = [...navLinks, cta].filter(Boolean);
    const setActive = (id) => {
      allLinks.forEach(l => {
        const match = l.getAttribute('href') === id;
        l.classList.toggle('active', match);
        l.setAttribute('aria-current', match ? 'page' : 'false');
      });
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          const id = `#${e.target.id}`;
          setActive(id);
        }
      });
    }, { rootMargin: "-45% 0px -45% 0px", threshold: 0.01 });

    ["home","about","infusion","retail","DeliverItHealth","gccTraining","DeliverItRAD"].forEach(id => {
      const el = document.getElementById(id);
      if (el) observer.observe(el);
    });
  });
</script>

<style>
:root{
  --brand:#36aa67;
  --berry:#a12d35;
  --ink:#0b1320;
  --header-h:72px;
}

a { text-decoration: none; }

.site-header{
  position: sticky; top: 0; z-index: 100;
  backdrop-filter: saturate(140%) blur(8px);
  background: rgba(255,255,255,.86);
  border-bottom: 1px solid rgba(0,0,0,.08);
  transition: .2s ease padding, .2s ease background, .2s ease box-shadow;
}
/* .site-header::after{
  content:""; position:absolute; left:0; right:0; bottom:-1px; height:2px;
  background: linear-gradient(90deg, var(--brand), var(--berry));
  opacity:.9;
} */
.site-header.scrolled{
  background: rgba(255,255,255,.96);
  box-shadow: 0 6px 24px rgba(0,0,0,.08);
}

.shell{
  width: min(1280px, 92%); margin:0 auto;
  display:flex; align-items:center; justify-content:space-between;
  min-height: var(--header-h);
  gap: 12px;
}
.brand img{ object-fit: contain; width: 120px; height: 56px; display:block; }

/* Hamburger */
.menu{
  display:inline-flex; flex-direction:column; gap:5px; padding:10px;
  background:transparent; border:0; cursor:pointer; color: var(--ink);
}
.menu span{ width:22px; height:2px; background:currentColor; border-radius:2px; transition:.3s; }
@media (min-width: 900px){ .menu{ display:none; } }

/* Animate hamburger into X */
.site-header.open .menu span:nth-child(1){ transform: translateY(7px) rotate(45deg); }
.site-header.open .menu span:nth-child(2){ opacity: 0; }
.site-header.open .menu span:nth-child(3){ transform: translateY(-7px) rotate(-45deg); }

/* Nav */
.nav{
  position: fixed; top: var(--header-h); left: 0; right: 0;
  background: #fff;
  display: grid; gap: 8px; padding: 14px 16px;
  transform: translateY(-8px);
  opacity: 0; visibility: hidden;
  transition: .2s opacity, .2s transform, .2s visibility;
}
.site-header.open .nav{ opacity: 1; visibility: visible; transform: translateY(0); }

@media (min-width: 900px){
  .nav{
    position: static; background: transparent; border: 0;
    display:flex; align-items:center; gap: 6px 10px;
    opacity:1; visibility:visible; transform:none; padding:0;
  }
}

/* Links */
.nav-link{
  display:inline-flex; align-items:center; gap:.4rem;
  padding:.5rem .8rem; border-radius:999px; font-weight:700;
  color: var(--ink); border:1px solid transparent; line-height: 1;
}
.nav-link:hover{ background: rgba(0,0,0,.04); border-color: rgba(0,0,0,.08); }

.nav-link.active{
  background: linear-gradient(90deg, var(--brand), var(--berry));
  color: #fff; box-shadow: 0 8px 20px rgba(0,0,0,.15);
}

/* CTA */
.nav-cta{
  display:inline-flex; align-items:center; margin-left: 2px;
  padding:.55rem .9rem; border-radius:12px; font-weight:800; line-height:1;
  background: linear-gradient(90deg, var(--brand), var(--berry));
  color:#fff; box-shadow: 0 8px 20px rgba(0,0,0,.15);
}
.nav-cta:hover{ filter: saturate(1.1); transform: translateY(-1px); transition:.2s; }

/* Anchor offset so sections don't hide under header */
:global(section[id]){ scroll-margin-top: calc(var(--header-h) + 12px); }
</style>
