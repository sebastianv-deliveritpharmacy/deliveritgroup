---
const {
  logoSrc = "/images/logo-deliverit.png",
} = Astro.props;

const links = [
  { label: "Infusion", href: "#infusion" },
  { label: "Retail", href: "#retail" },
  { label: "DeliverIt Health", href: "#DeliverItHealth" },
  { label: "DeliverIt Research & Development", href: "#DeliverItRAD" },
];
---

<header class="site-header" aria-label="Top navigation">
  <div class="shell">
    <a class="brand" href="#home" aria-label="DeliverIt Group">
      <!-- Always light logo -->
      <img src={logoSrc} alt="DeliverIt logo" width="160" height="40" />
    </a>

    <!-- Hamburger button -->
    <button class="menu" aria-label="Open menu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>

    <nav class="nav" aria-label="Primary">
      {links.map(l => (
        <a class="nav-link" href={l.href}>{l.label}</a>
      ))}
    </nav>
  </div>
</header>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const header = document.querySelector('.site-header');
    if (!header) return;

    const btn = header.querySelector('.menu');
    const nav = header.querySelector('.nav');
    if (!btn || !nav) return;

    // Toggle menu
    btn.addEventListener('click', () => {
      const open = header.classList.toggle('open');
      btn.setAttribute('aria-expanded', String(open));
    });

    // Close menu when clicking a link (mobile)
    header.querySelectorAll('.nav-link').forEach(a =>
      a.addEventListener('click', () => {
        header.classList.remove('open');
        btn.setAttribute('aria-expanded', "false");
      })
    );

    // Scroll spy
    const navLinks = [...header.querySelectorAll('.nav-link')];
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          const id = `#${e.target.id}`;
          navLinks.forEach(l => l.classList.toggle('active', l.getAttribute('href') === id));
        }
      });
    }, { rootMargin: "-45% 0px -45% 0px", threshold: 0.01 });

    ["home","about","infusion","retail","DeliverItHealth","DeliverItRAD"].forEach(id => {
      const el = document.getElementById(id);
      if (el) observer.observe(el);
    });
  });
</script>

<style>
:root{ --brand:#36aa67; --berry:#a12d35; --header-h:72px; }

a { text-decoration: none; }

.site-header{
  position: sticky; top: 0; z-index: 100;
  backdrop-filter: saturate(140%) blur(8px);
  background: rgba(255,255,255,.86);
  border-bottom: 1px solid rgba(0,0,0,.08);
}
.site-header::after{
  content:""; position:absolute; left:0; right:0; bottom:-1px; height:2px;
  background: linear-gradient(90deg, var(--brand), var(--berry));
  opacity:.9;
}

.shell{
  width: min(1280px, 92%); margin: 0 auto;
  display:flex; align-items:center; justify-content:space-between;
  min-height: var(--header-h);
}
.brand img{ object-fit: contain; width: 81px; height: 82px; display:block; }

/* Hamburger */
.menu{
  display:inline-flex; flex-direction:column; gap:5px; padding:10px;
  background:transparent; border:0; cursor:pointer;
}
.menu span{ width:22px; height:2px; background:currentColor; border-radius:2px; transition:.3s; }
@media (min-width: 900px){ .menu{ display:none; } }

/* Animate hamburger into X */
.site-header.open .menu span:nth-child(1){ transform: rotate(45deg) translateY(7px); }
.site-header.open .menu span:nth-child(2){ opacity: 0; }
.site-header.open .menu span:nth-child(3){ transform: rotate(-45deg) translateY(-7px); }

/* Nav */
.nav{
  position: fixed; top: var(--header-h); left: 0; right: 0;
  background: #fff; /* Always light */
  display: grid; gap: 8px; padding: 12px 16px;
  transform: translateY(-8px);
  opacity: 0; visibility: hidden;
  transition: .2s opacity, .2s transform, .2s visibility;
}
.site-header.open .nav{ opacity: 1; visibility: visible; transform: translateY(0); }
@media (min-width: 900px){
  .nav{ position: static; background: transparent; border: 0;
    display:flex; gap: 12px; opacity:1; visibility:visible; transform:none; padding:0; }
}

.nav-link{
  display:inline-flex; align-items:center; gap:.4rem;
  padding:.5rem .8rem; border-radius:999px; font-weight:700;
  color: inherit; border:1px solid transparent;
}
.nav-link:hover{ background: rgba(0,0,0,.04); border-color: rgba(0,0,0,.08); }

.nav-link.active{
  background: linear-gradient(90deg, var(--brand), var(--berry));
  color: white; box-shadow: 0 8px 20px rgba(0,0,0,.15);
}

/* Anchor offset so sections don't hide under header */
:global(section[id]){ scroll-margin-top: calc(var(--header-h) + 12px); }
</style>
